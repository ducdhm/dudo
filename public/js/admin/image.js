!function(e,a){if("function"==typeof define&&define.amd)define([],a);else if("undefined"!=typeof exports)a();else{a(),e.image={}}}(this,function(){"use strict";!function(r){Dropzone.autoDiscover=!1;var s=new Dropzone("#image-upload-widget",{paramName:"file",maxFilesize:3,acceptedFiles:"image/*",autoProcessQueue:!1,dictDefaultMessage:"Drag &amp; drop or click to choose upload file",dictFileTooBig:"Your file has exceeded {{maxFilesize}}MB",dictInvalidFileType:"Your file is not image"});s.on("thumbnail",function(e){if(!e.cropped){var a=e.name;s.removeFile(e);var t=r(' <div class="modal"> <div class="modal-dialog modal-lg"> <div class="modal-content"> <div class="modal-header"> <button type="button" class="close crop-cancel" data-dismiss="modal" aria-label="Close"> <span aria-hidden="true">&times;</span></button> <h4 class="modal-title">Crop Image</h4> </div> <div class="modal-body"> <div class="image-container"></div> </div> <div class="modal-footer"> <div class="pull-left"> <span data-width></span> x <span data-height></span> </div> <button type="button" class="btn btn-default crop-cancel" data-dismiss="modal">Close</button> <button type="button" class="btn btn-primary crop-upload">Crop & Upload</button> </div> </div> </div> </div> '),o=t.find(".crop-upload"),i=t.find(".crop-cancel");t.modal({backdrop:"static",keyboard:!1}),t.on("show.bs.modal",function(e){console.log("Fired"),1<r(".modal-backdrop").length&&r(".modal-backdrop").not(":first").remove()}).modal("show");var n=r('<img class="img-responsive" />'),d=new FileReader;d.onloadend=function(){t.find(".image-container").html(n),n.attr("src",d.result),n.cropper({preview:".image-preview",viewMode:3,aspectRatio:"",movable:!1,cropBoxResizable:!0,crop:function(e){var a=r(this).parents(".modal"),t=a.find("span[data-width]"),o=a.find("span[data-height]"),i=Math.round(e.detail.width),n=Math.round(e.detail.height);t.attr("data-width",i).text("Width: "+i),o.attr("data-width",n).text("Height: "+n)}})},d.readAsDataURL(e),o.on("click",function(){var e=function(e){for(var a=atob(e.split(",")[1]),t=new ArrayBuffer(a.length),o=new Uint8Array(t),i=0;i<a.length;i++)o[i]=a.charCodeAt(i);return new Blob([t],{type:"image/jpeg"})}(n.cropper("getCroppedCanvas").toDataURL());e.cropped=!0,e.name=a,s.addFile(e),s.processQueue(),t.modal("hide"),t.remove()}),i.on("click",function(){t.modal("hide"),t.remove()})}}),s.on("success",function(e){this.removeFile(e),r("#images-wrapper").reloadFragment()}),r("#images-wrapper").on("click",".btn-select-image",function(e){e.preventDefault();var a=r(this).attr("href");window.opener&&window.opener.onSelectImage(a)}),r("#images-wrapper").on("click",".btn-delete-image",function(e){e.preventDefault();var a=r(this).closest(".image");confirm("Are you sure you want to delete this image?")&&r.ajax({url:"/image/delete",type:"post",dataType:"json",data:{file:a.attr("title")}}).done(function(e){e&&e.status&&(Msg.success("Deleted!"),r("#images-wrapper").reloadFragment())})})}(jQuery)});
//# sourceMappingURL=image.js.map
